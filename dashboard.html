<div style="text-align:center; padding:20px;">
  <h2>Smart Recommendation Engine</h2>
  <p>Select a user to view personalized recommendations:</p>
  
  <!-- User Dropdown -->
  <select id="userDropdown"></select>
  
  <!-- Recommendations Table -->
  <div id="recommendations" style="margin-top:20px;"></div>
  
  <!-- Chart -->
  <div id="clusterChart" style="width:800px; margin:0 auto; margin-top:30px;"></div>
</div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
  async function loadUsers() {
    const response = await fetch('/api/users');
    const users = await response.json();
    const dropdown = document.getElementById('userDropdown');
    dropdown.innerHTML = users.map(u => `<option value="${u}">${u}</option>`).join('');
    fetchRecommendations(users[0]);
  }

  async function fetchRecommendations(userId) {
    const response = await fetch(`/api/recommend/${userId}`);
    const recs = await response.json();
    document.getElementById('recommendations').innerHTML =
      "<h3>Recommended Learning Path:</h3><ul>" + recs.map(r => `<li>${r}</li>`).join('') + "</ul>";

    // Cluster visualization
    const chart = {
      x: recs.map((r, i) => i+1),
      y: recs.map(r => r.length),
      type: 'bar'
    };
    Plotly.newPlot('clusterChart', [chart], {title: 'Recommendation Visual Strength'});
  }

  document.getElementById('userDropdown').addEventListener('change', e => {
    fetchRecommendations(e.target.value);
  });

  loadUsers();
</script>
